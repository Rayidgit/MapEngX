// faculty_map2.js
document.addEventListener("DOMContentLoaded", function () {
    initMap('map');
});



function initMap(map_div) {
    const southWest = L.latLng(7.252000, 80.590528);
    const northEast = L.latLng(7.255500, 80.593528);
    const bounds = L.latLngBounds(southWest, northEast);

    map = L.map(map_div, {
        maxZoom: 22,
        minZoom: 18,
        maxBounds: bounds,
        maxBoundsViscosity: 1.0
    }).setView([7.253750, 80.592028], 19);

    // Create custom panes
    map.createPane('routePane');
    map.getPane('routePane').style.zIndex = 650;

    // Add OpenStreetMap tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 22
    }).addTo(map);

    const nodes = [
      { "lat": 7.252251, "lng": 80.593313 }, //0
      { "lat":7.252277, "lng": 80.593011 },  //1
      { "lat": 7.252300, "lng": 80.592549 }, //2
      { "lat": 7.253906, "lng": 80.592586 }, //3
      { "lat": 7.254649, "lng": 80.592984 }, //4 
      //{ "lat": 7.254649, "lng": 80.592984 }, 
      { "lat": 7.253905, "lng": 80.591841 }, //5
      { "lat": 7.252398, "lng": 80.591824 }, //6
      { "lat": 7.253602, "lng": 80.592566 }, //7
      { "lat": 7.255161, "lng": 80.591851 }, //8
      { "lat": 7.253608, "lng": 80.591835 }, //9
      { "lat": 7.254571, "lng": 80.591849 }, //10
      { "lat": 7.254582, "lng": 80.590999 }, //11
      { "lat": 7.254360, "lng": 80.591845 }, //12
      { "lat": 7.254363, "lng": 80.590996 }, //13
      { "lat": 7.252537, "lng": 80.591302 }, //14
      { "lat": 7.252605, "lng": 80.591334 }, //15
      { "lat": 7.252614, "lng": 80.591822 }, //16
      { "lat": 7.252830, "lng": 80.592547 }, //17
      { "lat": 7.2535485102533634, "lng":80.59256955516327 }, //18
      { "lat": 7.253890413435412, "lng":80.59263809619348 }, //19
      { "lat": 7.253602, "lng": 80.592387 }, //20
      { "lat": 7.255159, "lng": 80.592325 }, //21
      { "lat": 7.255160, "lng": 80.591981 }, //22
      { "lat": 7.253762, "lng": 80.591840 }, //23
      { "lat": 7.253139, "lng": 80.591828 }, //24
      { "lat": 7.253254, "lng":80.5918274 }, //25
      { "lat": 7.252840, "lng": 80.591823 }, //26
      { "lat": 7.252682, "lng": 80.591822 }, //27                                             
      { "lat": 7.254113, "lng": 80.591842 }, //28                                   
      { "lat": 7.253141530173527, "lng":80.59267449631493}, //29
      { "lat": 7.253686307257856, "lng":80.5926585739702 }, //30
      { "lat": 7.253652, "lng": 80.592384 }, //31
      { "lat": 7.255215, "lng": 80.592324 }, //32
      { "lat": 7.2551498179085, "lng":80.59223750628004 }, //33
      { "lat": 7.254894703830539, "lng":80.59224241192963 }, //34
      { "lat": 7.254588, "lng": 80.591181 }, //35
      { "lat": 7.253756, "lng": 80.591892 }, //36
      { "lat": 7.253551, "lng": 80.591387 }, //37
      { "lat": 7.253587, "lng": 80.591639 }, //38
      { "lat": 7.253409, "lng": 80.591804 }, //39
      { "lat": 7.254113, "lng": 80.591818 }, //40
      { "lat": 7.255124368684365, "lng": 80.5922251540533}, //41
      { "lat": 7.254934812453356, "lng":80.59120520779946 },//42
      { "lat": 7.254372, "lng": 80.591191 },//43
      { "lat": 7.254126, "lng": 80.591065 },//44
      { "lat": 7.253669, "lng": 80.591518 },//45
       { "lat": 7.252842, "lng":80.5911381 },//46
      { "lat": 7.252821, "lng":80.5921501 },//47
      { "lat": 7.252683, "lng": 80.591796 },//48
      { "lat": 7.253892, "lng": 80.593006 },//49
      { "lat": 7.253256, "lng": 80.5916558 },//50
      { "lat": 7.253398, "lng":80.59183340 },//51
      { "lat": 7.253507, "lng":80.591831 },//52
      { "lat": 7.253509, "lng":80.591391 },//53
      { "lat": 7.253783509931466, "lng":80.59174096708753 },//54
      { "lat": 7.2542945, "lng":80.59184 },//55
      { "lat": 7.25429083,"lng":80.59180},//56
      { "lat": 7.25392999, "lng":80.5917},//57
      { "lat": 7.25462504, "lng":80.59185},//58
      { "lat": 7.25462782, "lng":80.591764},//59
      { "lat": 7.25479325, "lng":80.591851},//60
      { "lat": 7.25479021, "lng":80.591785},//61
      { "lat": 7.254932724831178, "lng":80.59100949205116},//62
      { "lat": 7.255147749874023, "lng":80.59122835697457},//63
      { "lat": 7.25411173, "lng":80.59098},//64
      { "lat": 7.25341807, "lng":80.590988},//65
      { "lat": 7.25340622, "lng":80.5911322},//66
      { "lat": 7.253794549, "lng": 80.5909588},//67
      { "lat": 7.253547, "lng": 80.592641},//68
      { "lat": 7.253774334104083, "lng":80.59264394698683},//69
      { "lat": 7.253845901496871, "lng":80.59240357018209},//70
      { "lat": 7.253894698263171, "lng":80.59237282614133},//71
      { "lat": 7.254743487865291, "lng":80.59297243921539},//72
      { "lat": 7.254923916756588, "lng":80.59282931658615},//73
      { "lat": 7.255154629003991, "lng":80.59248641862024},//74
      { "lat": 7.254810494796303, "lng":80.59191349787079},//75
      { "lat": 7.254950872721839, "lng":80.5922247932719},//76
      { "lat": 7.254706812685321, "lng":80.59220615062773},//77
      { "lat": 7.254934913299484, "lng":80.59184983639348},//78
      { "lat": 7.254288763116277, "lng":80.59243409517586},//79
      { "lat": 7.254288763116277, "lng":80.59207818659192},//80
      { "lat": 7.254429081697522, "lng":80.5920721026845},//81
      { "lat": 7.254174094132852, "lng":80.59211621101191},//82
      { "lat": 7.253965879330241, "lng":80.59211925296562},//83
      { "lat": 7.2525918029128595, "lng":80.59243856624786},//84
      { "lat": 7.2525781957939, "lng":80.59254007104289},//85
      { "lat": 7.253141530173527, "lng":80.59255653128288},//86
      { "lat": 7.25465173930813, "lng":80.59269132137403},//87
      { "lat": 7.2545625738991895, "lng":80.59257896517803},//88
      { "lat": 7.254364923846417, "lng":80.59257596901281},//89
      { "lat": 7.254201453812384, "lng":80.59258345942587},//90
      { "lat": 7.252464262123155, "lng":80.5913669217902},//91
      { "lat": 7.254282541721773, "lng":80.59236428680173},//92
      { "lat": 7.253907897449925, "lng":80.59212445437788},//93
      { "lat": 7.254907673364133, "lng":80.59120941674028},//94
      { "lat": 7.254928451047082, "lng":80.59222285763707},//95
      { "lat": 7.253660939097103, "lng":80.59184025614312}//96
                                            
      //, 
    ];

    const edges = [
      { "id": "E1", "from": 0, "to": 1, "coords": [[7.252251,80.593313],[7.252277,80.593011]] }, // done
      { "id": "e12", "from": 1, "to": 2, "coords": [[7.252277,80.593011],[7.252310,80.592530]] }, //done
      { "id": "e149", "from": 1, "to": 49, "coords": [[7.252277,80.593011],[7.253892,80.593006]] }, // done
      { "id": "e26", "from": 2, "to": 6, "coords": [[7.252310,80.592530],[7.252398,80.591824]] }, // done
      { "id": "e8517", "from": 85, "to": 17, "coords": [[7.2525781957939, 80.59254007104289],[7.252830,80.592547]] },// done
      { "id": "e285", "from": 2, "to": 85, "coords": [[7.252310,80.592530],[7.2525781957939, 80.59254007104289]] },
      { "id": "e1718", "from": 17, "to": 18, "coords": [[7.252830, 80.592547],[7.2535485102533634, 80.59256955516327]] }, // done
      { "id": "e691", "from": 6, "to": 91, "coords": [[7.252398,80.591824],[7.252464262123155, 80.5913669217902]] }, // done
      { "id": "e9114", "from": 91, "to": 14, "coords": [[7.252464262123155, 80.5913669217902],[7.252537,80.591302]] }, // done
      { "id": "e616", "from": 6, "to": 16, "coords": [[7.252398, 80.591824],[7.252614, 80.591822]] }, // done
      { "id": "e1415", "from": 14, "to": 15, "coords": [[7.252537, 80.591302],[7.252605, 80.591334]] }, // done
      { "id": "e1446", "from": 14, "to": 46, "coords": [[7.252537, 80.591302],[7.252842, 80.5911381]] }, // done
      { "id": "e1516", "from": 15, "to": 16, "coords": [[7.252605, 80.591334],[7.252614, 80.591822]] }, // done
      { "id": "e1627", "from": 16, "to": 27, "coords": [[7.252614, 80.591822],[7.252682, 80.591822]] }, // done
      { "id": "e2748", "from": 27, "to": 48, "coords": [[7.252682, 80.591822],[7.252683, 80.591796]] }, // done
      { "id": "e2726", "from": 27, "to": 26, "coords": [[7.252682, 80.591822],[7.252840, 80.591823]] }, // done
      { "id": "e2647", "from": 26, "to": 47, "coords": [[7.252840, 80.591823],[7.252821, 80.5921501]] }, // done
      { "id": "e2624", "from": 26, "to": 24, "coords": [[7.252840, 80.591823],[7.253139, 80.591828]] }, // done
      { "id": "e2425", "from": 24, "to": 25, "coords": [[7.253139, 80.591828],[7.253254, 80.5918274]] },//done
      { "id": "e2550", "from": 25, "to": 50, "coords": [[7.253254, 80.591827],[7.253256, 80.5916558]] },//done
      { "id": "e2551", "from": 25, "to": 51, "coords": [[7.253254, 80.591827],[7.253398, 80.5918334]] },// done
      { "id": "e5139", "from": 51, "to": 39, "coords": [[7.253398, 80.591833],[7.25340, 80.591804]] },// done
      { "id": "e5152", "from": 51, "to": 52, "coords": [[7.253398, 80.591833],[7.253507,80.591831]] }, //done
      { "id": "e529", "from": 52, "to": 9, "coords": [[7.253507,80.591831],[7.253608, 80.591835]] }, //done
      { "id": "e5253", "from": 52, "to": 53, "coords": [[7.253507,80.591831],[7.253509, 80.591391]] }, //done
      { "id": "e5337", "from": 53, "to": 37, "coords": [[7.253509, 80.591391],[7.253551, 80.591387]] }, //done
      { "id": "e938", "from": 9, "to": 38, "coords": [[7.253608, 80.591835],[7.253587, 80.591639]] },// done
      { "id": "e996", "from": 9, "to": 96, "coords": [[7.253608, 80.591835],[7.253660939097103, 80.59184025614312]] },// done
      { "id": "e920", "from": 9, "to": 20, "coords": [[7.253608, 80.591835],[7.253602, 80.592387]] },//done
      { "id": "e2354", "from": 23, "to": 54, "coords": [[7.253762, 80.591840],[7.253783509931466, 80.59174096708753]] },//done
      { "id": "e2336", "from": 23, "to": 36, "coords": [[7.253762, 80.591840],[7.253756, 80.591892]] },//done
      { "id": "e235", "from": 23, "to": 5, "coords": [[7.253762, 80.591840],[7.253905, 80.591841]] },//done
      { "id": "e9623", "from": 96, "to": 23, "coords": [[7.253660939097103, 80.59184025614312],[7.253762,  80.591840]] },//done
  { "id": "e528", "from": 5, "to": 28, "coords": [[7.253905, 80.591841],[7.254113, 80.591842]] },//done
      { "id": "e557", "from": 5, "to": 57, "coords": [[7.253905, 80.591841],[7.25392999, 80.5917]] },//done
      { "id": "e2840", "from": 28, "to": 40, "coords": [[7.254113, 80.591842],[7.254113, 80.5918]] },//done
      { "id": "e2855", "from": 28, "to": 55, "coords": [[7.254113, 80.591842],[7.2542945, 80.59184]] },//done
      { "id": "e5556", "from": 55, "to": 56, "coords": [[7.2542945, 80.59184],[7.25429083, 80.59180]] },//done
      { "id": "e5512", "from": 55, "to": 12, "coords": [[7.2542945, 80.59184],[7.254360, 80.591845]] },//done
      { "id": "e1243", "from": 12, "to": 43, "coords": [[7.254360, 80.591845],[7.254372, 80.591191]] },// done
      { "id": "e4313", "from": 43, "to": 13, "coords": [[7.254372, 80.591191],[7.254363, 80.590996]] },//done
      { "id": "e1311", "from": 13, "to": 11, "coords": [[7.254363, 80.590996],[7.254582, 80.590999]] },//done
      { "id": "e1210", "from": 12, "to": 10, "coords": [[7.254360, 80.591845],[7.254571, 80.591849]] },//done
      { "id": "e1135", "from": 11, "to": 35, "coords": [[7.254582, 80.590999],[7.254588, 80.591181]] },// done
       { "id": "e1058", "from": 10, "to": 58, "coords": [[7.254571, 80.591849],[7.25462504,80.59185]] },//done
       { "id": "e5859", "from": 58, "to": 59, "coords": [[7.25462504, 80.59185],[7.25462782,80.591764]] },//done
      { "id": "e5860", "from": 58, "to": 60, "coords": [[7.25462504, 80.59185],[7.25479325, 80.591851]] },//done
     { "id": "e6061", "from": 60, "to": 61, "coords": [[7.25479325, 80.591851],[7.25479021, 80.591785]] },//done
      //{ "id": "e608", "from": 60, "to": 8, "coords": [[7.25479325, 80.591851],[7.255161, 80.591851]] },//done
       { "id": "e863", "from": 8, "to": 63, "coords": [[7.255161, 80.591851],[7.255147749874023, 80.59122835697457]] },//done
    { "id": "e6263", "from": 62, "to": 63, "coords": [[7.254932724831178,80.59100949205116],[7.254959863918888, 80.59101370099197],[7.254976564895125, 80.59102211887361],[7.25504128117222, 80.59104947698899],[7.255110172682755, 80.5911062976901],[7.2551310488959935, 80.59113996921668],[7.255149837487079, 80.59118205862494],[7.255147749874023, 80.59122835697457]] },//done
      { "id": "e1162", "from": 11, "to": 62, "coords": [[7.254582,  80.590999 ],[7.254932724831178, 80.59100949205116]] },//done
      { "id": "e1364", "from": 13, "to": 64, "coords": [[7.254363, 80.590996],[7.25411173,80.59098]] },//done
       { "id": "e6444", "from": 64, "to": 44, "coords": [[7.25411173,80.59098],[7.254126, 80.591065]] },//done
     { "id": "e4665", "from": 46, "to": 65, "coords": [[7.252842, 80.5911381],[7.25341807, 80.590988]] },//done
       { "id": "e6567", "from": 65, "to": 67, "coords": [[7.25341807, 80.590988],[7.253794549, 80.5909588]] },//done
     { "id": "e6764", "from": 67, "to": 64, "coords": [[7.253794549, 80.5909588],[7.25411173, 80.59098]] }, //done
     { "id": "e6566", "from": 65, "to": 66, "coords": [[7.25341807, 80.590988],[7.25340622, 80.5911322]] },//done
     { "id": "e207", "from": 20, "to": 7, "coords": [[7.253602, 80.592387],[7.253602,  80.592566 ]] },//done
     { "id": "e187", "from": 18, "to": 7, "coords": [[7.2535485102533634, 80.59256955516327],[7.253602,  80.592566 ]] },//done
     { "id": "e6830", "from": 68, "to": 30, "coords": [[7.253547, 80.592641],[7.253686307257856, 80.5926585739702 ]] },//done
     { "id": "e1868", "from": 18, "to": 68, "coords": [[7.2535485102533634, 80.59256955516327],[7.253547, 80.592641 ]] },//done
     { "id": "e4919", "from": 49, "to": 19, "coords": [[7.253892, 80.593006],[7.253890413435412, 80.59263809619348]] },//done
     { "id": "e193", "from": 19, "to": 3, "coords": [[7.253890413435412, 80.59263809619348],[7.253906,  80.592586 ]] },//done
     { "id": "e1969", "from": 19, "to": 69, "coords": [[7.253890413435412, 80.59263809619348],[7.253774334104083, 80.59264394698683]] },//done
     { "id": "e73", "from": 7, "to": 3, "coords": [[7.253602, 80.592566],[7.253906, 80.592586]] },//done
     { "id": "e371", "from": 3, "to": 71, "coords": [[7.253906, 80.592586],[7.253894698263171, 80.59237282614133 ]] },//done
     { "id": "e7193", "from": 71, "to": 93, "coords": [[7.253894698263171, 80.59237282614133],[7.253907897449925, 80.59212445437788 ]] },//done
     { "id": "e7071", "from": 70, "to": 71, "coords": [[7.253845901496871, 80.59240357018209],[7.253894698263171, 80.59237282614133]] },//done
     { "id": "e449", "from": 4, "to": 49, "coords": [[7.254649,  80.592984],[7.253892, 80.593006]] },//done
     { "id": "e472", "from": 4, "to": 72, "coords": [[7.254649,  80.592984],[7.254743487865291, 80.59297243921539]] },//done
     { "id": "e7273", "from": 72, "to": 73, "coords": [[7.254743487865291, 80.59297243921539],[7.254799538028254, 80.59295452594816],[7.25489669460078, 80.59286637935494],[ 7.254923916756588, 80.59282931658615]] },//done
     { "id": "e7374", "from": 73, "to": 74, "coords": [[ 7.254923916756588, 80.59282931658615],[ 7.255154629003991, 80.59248641862024]] },//done
     { "id": "e7421", "from": 74, "to": 21, "coords": [[7.255154629003991, 80.59248641862024],[ 7.255159,  80.592325]] },//done
     { "id": "e2132", "from": 21, "to": 32, "coords": [[7.255159,  80.592325],[7.255215,  80.592324]] },// done
     { "id": "e2133", "from": 21, "to": 33, "coords": [[7.255159,  80.592325],[7.2551498179085, 80.59223750628004 ]] },//done
     { "id": "e3341", "from": 33, "to": 41, "coords": [[7.2551498179085, 80.59223750628004],[7.255124368684365,80.5922251540533]] },//done
     { "id": "e3322", "from": 33, "to": 22, "coords": [[7.2551498179085, 80.59223750628004],[7.255160, 80.591981]] },//done
     { "id": "e228", "from": 22, "to": 8, "coords": [[7.255160, 80.591981],[7.255161, 80.591851]] },//done
     { "id": "e6075", "from": 60, "to": 75, "coords": [[7.25479325, 80.591851],[7.254810494796303, 80.59191349787079]] },//done
     { "id": "e878", "from": 8, "to": 78, "coords": [[7.255161, 80.591851],[7.254934913299484, 80.59184983639348]] },//done
     { "id": "e7895", "from": 78, "to": 95, "coords": [[7.254934913299484, 80.59184983639348],[7.254928451047082, 80.59222285763707]] },//done
     { "id": "e7860", "from": 78, "to": 60, "coords": [[7.254934913299484, 80.59184983639348],[7.25479325, 80.591851]] },//done
     { "id": "e7758", "from": 77, "to": 58, "coords": [[7.254706812685321, 80.59220615062773],[7.254704596551573, 80.59185491302169],[7.25462504, 80.59185]] },//done
     { "id": "e4262", "from": 42, "to": 62, "coords": [[7.254934812453356, 80.59120520779946],[7.254932724831178, 80.59100949205116]]},//done
     { "id": "e4278", "from": 42, "to": 78, "coords": [[7.254934812453356, 80.59120520779946],[7.254934913299484, 80.59184983639348]]},//done
     { "id": "e5580", "from": 55, "to": 80, "coords": [[7.2542945, 80.59184],[7.254288763116277, 80.59207818659192]]},//done
     { "id": "e8081", "from": 80, "to": 81, "coords": [[7.254288763116277, 80.59207818659192],[7.254429081697522, 80.5920721026845]]},//done
     { "id": "e8079", "from": 80, "to": 79, "coords": [[7.254288763116277, 80.59207818659192],[7.254288763116277, 80.59243409517586]]},//done
     { "id": "e8082", "from": 80, "to": 82, "coords": [[7.254288763116277, 80.59207818659192],[7.254174094132852, 80.59211621101191]]},//done
     { "id": "e496", "from": 45, "to": 96, "coords": [[7.253669, 80.591518],[7.253660939097103, 80.59184025614312]]},//done
     { "id": "e8584", "from": 85, "to": 84, "coords": [[7.2525781957939, 80.59254007104289],[7.2525918029128595, 80.59243856624786]]},//done
     { "id": "e8629", "from": 86, "to": 29, "coords": [[7.253141530173527, 80.59255653128288],[7.253141530173527, 80.59267449631493]]},//done
     //{ "id": "e7183", "from": 71, "to": 83, "coords": [[7.253894698263171, 80.59237282614133],[7.253965879330241, 80.59211925296562]]},//done,
     { "id": "e390", "from": 3, "to": 90, "coords": [[7.253906, 80.592586],[7.254201453812384, 80.59258345942587]]},//done
     { "id": "e8988", "from": 89, "to": 88, "coords": [[7.254364923846417, 80.59257596901281],[7.2545625738991895, 80.59257896517803]]},//done
     { "id": "e8887", "from": 88, "to": 87, "coords": [[7.2545625738991895, 80.59257896517803],[7.2545945648196595, 80.59258955496543],[7.254620528961871, 80.5926127373568],[7.254641300274551, 80.59264938049155],[7.25465173930813, 80.59269132137403]]},//done
     { "id": "e874", "from": 87, "to": 4, "coords": [[7.25465173930813, 80.59269132137403],[7.254649, 80.592984]]},
     { "id": "e7192", "from": 71, "to": 92, "coords": [[7.253894698263171, 80.59237282614133],[7.254282541721773, 80.59236428680173]]},
     { "id": "e9383", "from": 93, "to": 83, "coords": [[7.253907897449925, 80.59212445437788],[7.253965879330241, 80.59211925296562]]},
     { "id": "e935", "from": 93, "to": 5, "coords": [[7.253907897449925, 80.59212445437788],[7.253905, 80.591841]]},
     { "id": "e4294", "from": 42, "to": 94, "coords": [[7.254934812453356, 80.59120520779946],[7.254907673364133, 80.59120941674028]]},
     { "id": "e9576", "from": 95, "to": 76, "coords": [[7.254928451047082, 80.59222285763707],[7.254950872721839, 80.5922247932719]]},
     { "id": "e9534", "from": 95, "to": 34, "coords": [[7.254928451047082, 80.59222285763707],[7.2549249305518275, 80.59224088652566],[7.254894703830539, 80.59224241192963]]},
    ];


    // Add a marker
    L.marker([7.253891, 80.592230]).addTo(map);

    
    nodes.forEach((n,i) => {
      L.circleMarker([n.lat,n.lng], { radius: 4, color:'#222', pane:'routePane' })
        .addTo(map).bindTooltip(""+i, { permanent:true, direction:'top', offset:[0,-6] });
    });

    edges.forEach((e,i) => {
      L.polyline(e.coords,{color:'red',weight:5,pane:'routePane'}).addTo(map);
    })

    
        

    // Define nodes with integer IDs
    
  



    // Load SVG overlay
    fetch('map.svg')
        .then(res => res.text())
        .then(svgText => {
            const parser = new DOMParser();
            const svgDoc = parser.parseFromString(svgText, "image/svg+xml");
            const svgElement = svgDoc.documentElement;
            L.svgOverlay(svgElement, bounds).addTo(map);

            // Attach click listeners to SVG buildings
            const buildings = document.querySelectorAll('#_x3C_buildings_x3E_ .st4');
            buildings.forEach(building => {
                building.addEventListener('click', (event) => {
                    buildingClick(event.target.id);
                });
            });
        })
        .then(() => {
            //connectSSE();
        })
        .catch(err => console.error('Error loading SVG:', err));

    map.fitBounds(bounds);

    
    
      
    
      
}